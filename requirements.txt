from graphviz import Digraph

# Create a new directed graph
dot = Digraph(comment='DCAE Encoder Architecture')
dot.attr(rankdir='LR') # Left to Right layout, אפשר גם 'TB' ל-Top to Bottom

# Define nodes (boxes)
dot.node('A', 'Input Sequence\n(Length: 500, Channels: 1)')
dot.node('B', 'Conv Block 1\n(Dilation: 1, Out: 32)\nConv1D->GroupNorm->ReLU->Dropout')
dot.node('C', 'Conv Block 2\n(Dilation: 2, Out: 64)\nConv1D->GroupNorm->ReLU->Dropout')
dot.node('D', 'Conv Block 3\n(Dilation: 4, Out: 128)\nConv1D->GroupNorm->ReLU->Dropout')
dot.node('E', 'Conv Block 4\n(Dilation: 8, Out: 256)\nConv1D->GroupNorm->ReLU->Dropout')
dot.node('F', 'AdaptiveAvgPool1d\n(Target Output: 1)')
dot.node('G', 'Linear (fc_encoded)\n(Output Features: 64)')
dot.node('H', 'Latent Representation\n(Size: 64)')

# Define edges (arrows)
dot.edge('A', 'B')
dot.edge('B', 'C')
dot.edge('C', 'D')
dot.edge('D', 'E')
dot.edge('E', 'F')
dot.edge('F', 'G')
dot.edge('G', 'H')

# (אופציונלי: להוסיף חצים קטנים ל-Skip Connections אם רוצים)
# dot.edge('B', 'Decoder_Input_Skip1', style='dashed', arrowhead='none', constraint='false') # דוגמה
# dot.edge('C', 'Decoder_Input_Skip2', style='dashed', arrowhead='none', constraint='false')
# dot.edge('D', 'Decoder_Input_Skip3', style='dashed', arrowhead='none', constraint='false')
# dot.edge('E', 'Decoder_Input_Skip4', style='dashed', arrowhead='none', constraint='false')


# Render and save the diagram
# הפלט יהיה קובץ PDF (או פורמט אחר שתבחר) בשם 'encoder_architecture.gv.pdf'
# וגם קובץ מקור בשפת DOT בשם 'encoder_architecture.gv'
try:
    dot.render('encoder_architecture', view=True) # view=True ינסה לפתוח את הקובץ שנוצר
    print("Diagram 'encoder_architecture.gv.pdf' created successfully.")
except Exception as e:
    print(f"Error rendering diagram: {e}")
    print("Please ensure Graphviz is installed and in your system's PATH.")
    print("You can install it from https://graphviz.org/download/")
    print("On Debian/Ubuntu: sudo apt-get install graphviz")
    print("On macOS (with Homebrew): brew install graphviz")
